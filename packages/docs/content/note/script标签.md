---
title: script 标签加载时机记录
tags: html5 frontend
---

## `script` 标签加载

### 同步加载

​ 页面加载时，如果遇到`script`标签，默认回等到标签内部的`js`代码执行完毕后才回继续加载页面，这时如果是外链的脚步文件，还需额外等待`js`文件的下载过程。如果文件过大，则页面会长时间的进行阻塞，所以早期前端避免这种问题都是通过降低`script`标签出现顺序来解决，如避免将`script`标签放置在`head`中，而是放置在`body`后等操作。

### 异步加载

#### async

​ `html5`的新属性，只适合外部脚本文件。页面加载中遇到带有`async`属性的`script`标签后，会异步的进行脚本文件下载，此时页面并发的进行加载，不会发生阻塞。等到脚本文件下载完毕以后，才会阻塞页面的加载，待脚本文件执行完继续进行加载。

​ 这种机制决定了，如果加载中遇到多个带有`async`属性的脚本文件，由于脚本文件大小不一，文件下载完毕的时间不一定能和开始下载（即加载时`script`标签出现）的时间保持一致，所以不能保证脚本文件的执行顺序。

> 通过`createElement`创建的`script`标签默认为`async`模式

#### defer

​ `html5`的新属性，只适合外部脚本文件。页面加载中遇到带有`defer`属性的`script`标签后，也会异步的进行脚本文件下载，这一点和带有`async`属性的`script`标签表现一致。区别在于，带`defer`属性的文件不会在下载完毕以后立即执行，而是会等到整个页面全部加载完毕以后统一执行。

​ 这种延迟执行，使得带有`defer`属性的脚本文件，可以按照出现顺序来保证执行的顺序。

> 加载`es6`模块时，会设置`type=module`，这时是异步加载，不会造成浏览器阻塞
